<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Random Pok√©mon</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --card: #0b1022;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22d3ee;
      --accent2: #a78bfa;
      --danger: #ef4444;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(1200px 800px at 0% 0%, #111827, var(--bg));
      display: grid;
      place-items: center;
      padding: 20px;
    }

    .wrap {
      width: 100%;
      max-width: 980px;
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 18px;
    }

    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; }
    }

    header {
      grid-column: 1/-1;
      background: linear-gradient(90deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      backdrop-filter: blur(4px);
    }
    header h1 { margin: 0; font-size: 18px; letter-spacing: .3px; }

    .btn {
      appearance: none;
      border: 1px solid rgba(255,255,255,.15);
      background: linear-gradient(180deg, rgba(34,211,238,.15), rgba(167,139,250,.08));
      color: var(--text);
      border-radius: 12px;
      padding: 10px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease, opacity .2s ease;
      box-shadow: 0 8px 20px rgba(34,211,238,.15);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:disabled { opacity: .6; cursor: not-allowed; }

    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 16px;
      padding: 18px;
      display: grid;
      grid-template-columns: 260px 1fr;
      gap: 16px;
      align-items: center;
      min-height: 260px;
    }
    @media (max-width: 680px) {
      .card { grid-template-columns: 1fr; }
    }

    .art {
      width: 100%;
      aspect-ratio: 1/1;
      background: radial-gradient(60% 60% at 50% 50%, rgba(34,211,238,.18), rgba(167,139,250,.08), transparent), #0b1022;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 14px;
      display: grid; place-items: center;
      overflow: hidden;
    }
    .art img { width: 90%; max-width: 240px; image-rendering: -webkit-optimize-contrast; }

    .meta h2 { margin: 0 0 8px; font-size: 28px; }
    .meta .id { color: var(--muted); letter-spacing: .5px; font-variant-numeric: tabular-nums; }
    .types { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
    .type {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      font-size: 13px;
      letter-spacing: .3px;
    }

    .helper { color: var(--muted); font-size: 13px; }

    .sidepanel { display: grid; gap: 12px; align-content: start; }
    .row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px; }
    .row .note { font-size: 12px; color: var(--muted); }

    .loading {
      display: inline-flex; align-items: center; gap: 8px;
      font-size: 13px; color: var(--muted);
    }
    .spinner {
      width: 16px; height: 16px; border-radius: 50%;
      border: 2px solid rgba(255,255,255,.25);
      border-top-color: var(--accent);
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    footer { grid-column: 1/-1; text-align: center; color: var(--muted); font-size: 12px; }
    a { color: var(--accent); text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>üé≤ Random Pok√©mon</h1>
      <div>
        <button id="roll" class="btn">Surprise Me!</button>
      </div>
    </header>

    <section class="panel">
      <div class="card">
        <div class="art">
          <img id="art" alt="Pok√©mon artwork" src="" style="display:none;" />
        </div>
        <div class="meta">
          <div class="id" id="pid">#---</div>
          <h2 id="pname">Click ‚ÄúSurprise Me!‚Äù to get a random Pok√©mon</h2>
          <div class="types" id="types"></div>
          <div id="status" class="helper" style="margin-top:12px;"></div>
        </div>
      </div>
    </section>

    <aside class="panel sidepanel">
      <div class="row"><div>Cache status</div><div id="cacheStatus" class="note">‚Äî</div></div>
      <div class="row"><div>Total Pok√©mon available</div><div id="total" class="note">‚Äî</div></div>
      <div id="loading" class="loading" style="display:none;">
        <div class="spinner"></div> Fetching‚Ä¶
      </div>
      <div class="helper">Data and images courtesy of <a href="https://pokeapi.co/" target="_blank" rel="noopener">PokeAPI</a>.</div>
    </aside>

    <footer>¬© 2025 ‚Äî Random Pok√©mon picker</footer>
  </div>

  <script>
    const rollBtn = document.getElementById('roll');
    const imgEl = document.getElementById('art');
    const nameEl = document.getElementById('pname');
    const idEl = document.getElementById('pid');
    const typesEl = document.getElementById('types');
    const statusEl = document.getElementById('status');
    const cacheEl = document.getElementById('cacheStatus');
    const totalEl = document.getElementById('total');
    const loadingEl = document.getElementById('loading');

    const API = 'https://pokeapi.co/api/v2';
    const LIST_KEY = 'pokemon_list_v3';

    function titleCase(s){ return s.replace(/[-_]/g,' ').replace(/\b\w/g, c => c.toUpperCase()); }
    function pad3(n){ return '#' + String(n).padStart(3, '0'); }

    async function fetchWithTimeout(url, ms = 12000){
      const controller = new AbortController();
      const to = setTimeout(() => controller.abort(), ms);
      try {
        const res = await fetch(url, { signal: controller.signal });
        if(!res.ok) throw new Error('HTTP ' + res.status);
        return await res.json();
      } finally { clearTimeout(to); }
    }

    async function getList(){
      // Try cache first
      const cached = localStorage.getItem(LIST_KEY);
      if(cached){
        try {
          const data = JSON.parse(cached);
          if(Array.isArray(data) && data.length > 0){
            cacheEl.textContent = 'cached';
            totalEl.textContent = data.length;
            return data;
          }
        } catch(_){}
      }
      cacheEl.textContent = 'fetching‚Ä¶';
      // Fetch a big list of all pokemon (includes forms)
      const list = await fetchWithTimeout(`${API}/pokemon?limit=20000`);
      const results = list.results || [];
      localStorage.setItem(LIST_KEY, JSON.stringify(results));
      cacheEl.textContent = 'cached';
      totalEl.textContent = results.length;
      return results;
    }

    function pickOne(arr){ return arr[Math.floor(Math.random() * arr.length)]; }

    async function showRandom(){
      loading(true);
      statusEl.textContent = '';
      typesEl.innerHTML = '';
      imgEl.style.display = 'none';
      try {
        const list = await getList();
        const chosen = pickOne(list);
        const data = await fetchWithTimeout(chosen.url);
        // Prefer official artwork, fallback to default front sprite
        const img = (data.sprites?.other?.['official-artwork']?.front_default)
          || data.sprites?.front_default
          || '';
        const name = titleCase(data.name);
        const id = data.id;
        const types = data.types?.map(t => t.type?.name) || [];

        idEl.textContent = pad3(id);
        nameEl.textContent = name;
        typesEl.innerHTML = types.map(t => `<span class="type">${titleCase(t)}</span>`).join('');

        if(img){
          imgEl.src = img;
          imgEl.alt = name + ' artwork';
          imgEl.onload = () => { imgEl.style.display = 'block'; };
          imgEl.onerror = () => { imgEl.style.display = 'none'; };
        } else {
          imgEl.style.display = 'none';
        }
      } catch (err){
        console.error(err);
        statusEl.textContent = 'Failed to fetch Pok√©mon. Please try again.';
        // Minimal fallback: try a random id in plausible range
        try {
          const fallbackId = Math.floor(Math.random()*1025)+1;
          const data = await fetchWithTimeout(`${API}/pokemon/${fallbackId}`);
          const img = (data.sprites?.other?.['official-artwork']?.front_default) || data.sprites?.front_default || '';
          idEl.textContent = pad3(data.id);
          nameEl.textContent = titleCase(data.name);
          typesEl.innerHTML = (data.types||[]).map(t => `<span class="type">${titleCase(t.type?.name)}</span>`).join('');
          if(img){ imgEl.src = img; imgEl.style.display = 'block'; }
        } catch(_){}
      } finally { loading(false); }
    }

    function loading(is){
      rollBtn.disabled = is;
      loadingEl.style.display = is ? 'inline-flex' : 'none';
    }

    // Wire events
    rollBtn.addEventListener('click', showRandom);

    // Warm cache on load (non-blocking)
    (async ()=>{ try { await getList(); } catch(_){} })();
  </script>
</body>
</html>


